CREATE FUNCTION dbo.EncontrarNumerosCuenta (@texto VARCHAR(MAX))
RETURNS @resultados TABLE (NumeroCuenta VARCHAR(50), Posicion INT)
AS
BEGIN
    DECLARE @pos INT = 1, @len INT, @temp VARCHAR(50), @i INT = 1;
    DECLARE @segmentos INT, @guiones INT;
    
    WHILE @i <= LEN(@texto)
    BEGIN
        -- Buscar inicio potencial (dígito)
        IF SUBSTRING(@texto, @i, 1) LIKE '[0-9]'
        BEGIN
            -- Extraer segmento potencial (hasta el próximo espacio o fin de texto)
            SET @len = CHARINDEX(' ', @texto + ' ', @i) - @i;
            IF @len < 0 SET @len = LEN(@texto) - @i + 1;
            
            SET @temp = SUBSTRING(@texto, @i, @len);
            
            -- Verificar que solo contenga dígitos y guiones
            IF @temp LIKE '%[0-9]%-%[0-9]%-%[0-9]%' -- Tiene dos guiones separando dígitos
               AND @temp NOT LIKE '%[^0-9-]%'      -- No contiene otros caracteres
               AND LEN(@temp) - LEN(REPLACE(@temp, '-', '')) = 2 -- Exactamente dos guiones
            BEGIN
                -- Verificar que los guiones no estén al inicio o final
                IF @temp NOT LIKE '-%' AND @temp NOT LIKE '%-' 
                   AND CHARINDEX('--', @temp) = 0 -- No tiene guiones consecutivos
                BEGIN
                    INSERT INTO @resultados
                    VALUES (@temp, @i);
                    
                    SET @i = @i + @len;
                    CONTINUE;
                END
            END
        END
        SET @i = @i + 1;
    END
    RETURN;
END;
